##Ejercicio 11

f <- function(r){
  fx = -101.50 + 2.5 *(1+0.5*r)^-1 + 2.5 *(1+0.5*r)^-2 + 2.5 *(1+0.5*r)^-3 + 2.5 *(1+0.5*r)^-4 +2.5 *(1+0.5*r)^-5 +2.5 *(1+0.5*r)^-6 +2.5 *(1+0.5*r)^-7 +2.5 *(1+0.5*r)^-8 + 2.5 *(1+0.5*r)^-9 + 2.5 *(1+0.5*r)^-10 + 100*(1+0.5*r)^-10
  return(fx)
}

f<-expression(-101.50 + 2.5 *(1+0.5*r)^-1 + 2.5 *(1+0.5*r)^-2 + 2.5 *(1+0.5*r)^-3 + 2.5 *(1+0.5*r)^-4 +2.5 *(1+0.5*r)^-5 +2.5 *(1+0.5*r)^-6 +2.5 *(1+0.5*r)^-7 +2.5 *(1+0.5*r)^-8 + 2.5 *(1+0.5*r)^-9 + 2.5 *(1+0.5*r)^-10 + 100*(1+0.5*r)^-10)  #expresion que quiero derivar
fprima<-D(f,"r")
fprima  #derivada

f_deriv <- function(r){
  fprima = -(100 * ((1 + 0.5 * r)^-(10 + 1) * (10 * 0.5)) + (2.5 * ((1 + 
                                                                       0.5 * r)^-(10 + 1) * (10 * 0.5)) + (2.5 * ((1 + 0.5 * r)^-(9 + 
                                                                                                                                    1) * (9 * 0.5)) + (2.5 * ((1 + 0.5 * r)^-(8 + 1) * (8 * 0.5)) + 
                                                                                                                                                         (2.5 * ((1 + 0.5 * r)^-(7 + 1) * (7 * 0.5)) + (2.5 * ((1 + 
                                                                                                                                                                                                                  0.5 * r)^-(6 + 1) * (6 * 0.5)) + (2.5 * ((1 + 0.5 * r)^-(5 + 
                                                                                                                                                                                                                                                                             1) * (5 * 0.5)) + (2.5 * ((1 + 0.5 * r)^-(4 + 1) * (4 * 
                                                                                                                                                                                                                                                                                                                                   0.5)) + (2.5 * ((1 + 0.5 * r)^-(3 + 1) * (3 * 0.5)) + 
                                                                                                                                                                                                                                                                                                                                              (2.5 * ((1 + 0.5 * r)^-(2 + 1) * (2 * 0.5)) + 2.5 * ((1 + 
                                                                                                                                                                                                                                                                                                                                                                                                      0.5 * r)^-(1 + 1) * 0.5)))))))))))
  return(fprima)
}



Newton_Rawson <- function(P0, TOL, N){
  i=1
  while(i<=N){
    p = P0 - f(P0)/f_deriv(P0)
    if(abs(p-P0) < TOL){
      return(p)
    }
    i= i + 1
    P0 = p
  }
  print(paste("El metodo fracso luego de ", N," iteraciones"))
}


Newton_Rawson(0.5,10^-6,100)
